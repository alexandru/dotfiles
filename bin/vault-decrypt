#!/bin/bash

ENC_FILEPATH="$1"
DEST_DIRECTORY="$2"

if [ ! -f "$ENC_FILEPATH" ]; then
    echo "File not found: $ENC_FILEPATH" >&2
    echo "Usage: $0 <file.json.enc> <output-directory>" >&2
    exit 1
fi

if [ ! -d "$DEST_DIRECTORY" ]; then
    echo "Directory not found: $DEST_DIRECTORY" >&2
    echo "Usage: $0 <file.json.enc> <output-directory>" >&2
    exit 1
fi

DEST_FILEPATH="${ENC_FILEPATH%.enc}"
DEST_FILEPATH="$DEST_DIRECTORY/$(basename "$DEST_FILEPATH")"

openssl enc -aes-256-cbc -pbkdf2 -iter 2400000 -d -nopad -in "$ENC_FILEPATH" -out "$DEST_FILEPATH"
echo "Decrypted to: $DEST_FILEPATH"
